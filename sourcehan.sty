\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sourcehan}[2017/12/30 Adobe Source Han Fonts for CJK Typesetting]
\RequirePackage{xifthen}
\ifthenelse{\isundefined{\setCJKmainfont}}{
    \PackageWarning{sourcehan}{%
        `sourcehan` requires `xeCJK` or `ctex`,\MessageBreak
        which is not loaded. Now I try to load it\MessageBreak
        with fallback options, plain scheme,\MessageBreak
        which might be suitable for document mainly\MessageBreak
        written in western language but not CJK language.\MessageBreak
        Please load `ctex` by yourself\MessageBreak
        with your own options before this package.\MessageBreak
    }
    \RequirePackage{ifxetex}
    \ifxetex
        \RequirePackage[LoadFandol = false]{xeCJK}
    \else
        \RequirePackage[scheme = plain, fontset = none]{ctex}
    \fi
}{}
\defaultCJKfontfeatures{Script = CJK}
\newif\ifsourcehan@loadsourcepro
\sourcehan@loadsourceprotrue
\DeclareOption{no-sourcepro}{\sourcehan@loadsourceprofalse}
\DeclareOption{SC}{\defaultCJKfontfeatures{Script = CJK, Language = Chinese Simplified}}
\DeclareOption{TC}{\defaultCJKfontfeatures{Script = CJK, Language = Chinese Traditional}}
\DeclareOption{J}{\defaultCJKfontfeatures{Script = CJK, Language = Japanese}}
\DeclareOption{K}{\defaultCJKfontfeatures{Script = CJK, Language = Korean}}
\ProcessOptions\relax
\ifsourcehan@loadsourcepro\RequirePackage{sourcepro}\fi
\setCJKmainfont{shse}
\setCJKsansfont{shsa}
\setCJKmonofont{shsa}
\setCJKfamilyfont{zhsong}{shse}[Language = Chinese Simplified]
\DeclareRobustCommand{\songti}{\CJKfamily{zhsong}}
\setCJKfamilyfont{zhhei}{shsa}[Language = Chinese Simplified]
\DeclareRobustCommand{\heiti}{\CJKfamily{zhhei}}
\setCJKfamilyfont{思源宋体}{shse}[Language = Chinese Simplified]
\DeclareRobustCommand{\宋体}{\CJKfamily{思源宋体}}
\setCJKfamilyfont{思源黑体}{shsa}[Language = Chinese Simplified]
\DeclareRobustCommand{\黑体}{\CJKfamily{思源黑体}}
\setCJKfamilyfont{思源宋體}{shse}[Language = Chinese Traditional]
\DeclareRobustCommand{\宋體}{\CJKfamily{思源宋體}}
\setCJKfamilyfont{思源黑體}{shsa}[Language = Chinese Traditional]
\DeclareRobustCommand{\黑體}{\CJKfamily{思源黑體}}
\setCJKfamilyfont{源ノ明朝}{shse}[Language = Japanese]
\DeclareRobustCommand{\明朝}{\CJKfamily{源ノ明朝}}
\DeclareRobustCommand{\mincho}{\CJKfamily{源ノ明朝}}
\setCJKfamilyfont{源ノ角ゴシック}{shsa}[Language = Japanese]
\DeclareRobustCommand{\ゴシック}{\CJKfamily{源ノ角ゴシック}}
\DeclareRobustCommand{\gothic}{\CJKfamily{源ノ角ゴシック}}
\setCJKfamilyfont{본명조}{shse}[Language = Korean]
\DeclareRobustCommand{\본명조}{\CJKfamily{본명조}}
\setCJKfamilyfont{본고딕}{shsa}[Language = Korean]
\DeclareRobustCommand{\본고딕}{\CJKfamily{본고딕}}
\DeclareRobustCommand{\CJKswitch}[1]{%
    \ifthenelse{\equal{#1}{SC}}{\addCJKfontfeatures{Language = Chinese Simplified}}{%
    \ifthenelse{\equal{#1}{TC}}{\addCJKfontfeatures{Language = Chinese Traditional}}{%
    \ifthenelse{\equal{#1}{J}}{\addCJKfontfeatures{Language = Japanese}}{%
    \ifthenelse{\equal{#1}{K}}{\addCJKfontfeatures{Language = Korean}}{%
        \PackageError{sourcehan}{Language tag `#1` not recognized}{%
            \protect\CJKswitch\space only supports 4 language tags:\MessageBreak
            `SC` for Chinese Simplified,\MessageBreak
            `TC` for Chinese Traditional,\MessageBreak
            `J` for Japanese,\MessageBreak
            `K` for Korean.}%
    }}}}}
