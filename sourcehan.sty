\NeedsTeXFormat{LaTeX2e}
\ProvidesPackage{sourcehan}[2017/12/30 Adobe Source Han Fonts for CJK Typesetting]
\RequirePackage{xifthen}
\ifthenelse{\isundefined{\setCJKmainfont}}{
    \PackageWarning{sourcehan}{%
        `sourcehan` requires `xeCJK` or `ctex`,\MessageBreak
        which is not loaded. Now I try to load it\MessageBreak
        with fallback options, plain scheme,\MessageBreak
        which might be suitable for document mainly\MessageBreak
        written in western language but not CJK language.\MessageBreak
        Please load `ctex` by yourself\MessageBreak
        with your own options before this package.\MessageBreak
    }
    \RequirePackage{ifxetex}
    \ifxetex
        \RequirePackage[LoadFandol = false]{xeCJK}
    \else
        \RequirePackage[scheme = plain, fontset = none]{ctex}
    \fi
}{}
\newif\ifsourcehan@loadsourcepro
\sourcehan@loadsourceprotrue
\DeclareOption{no-sourcepro}{\sourcehan@loadsourceprofalse}
\DeclareOption{SC}{\defaultCJKfontfeatures{Script = CJK, Language = Chinese Simplified}}
\DeclareOption{TC}{\defaultCJKfontfeatures{Script = CJK, Language = Chinese Traditional}}
\DeclareOption{J}{\defaultCJKfontfeatures{Script = CJK, Language = Japanese}}
\DeclareOption{K}{\defaultCJKfontfeatures{Script = CJK, Language = Korean}}
\ProcessOptions\relax
\ifsourcehan@loadsourcepro\RequirePackage{sourcepro}\fi
\setCJKmainfont{shse}
\setCJKsansfont{shsa}
\setCJKmonofont{shsa}
\DeclareRobustCommand{\CJKswitch}[1]{%
    \ifthenelse{\equal{#1}{SC}}{\addCJKfontfeatures{Language = Chinese Simplified}}{%
    \ifthenelse{\equal{#1}{TC}}{\addCJKfontfeatures{Language = Chinese Traditional}}{%
    \ifthenelse{\equal{#1}{J}}{\addCJKfontfeatures{Language = Japanese}}{%
    \ifthenelse{\equal{#1}{K}}{\addCJKfontfeatures{Language = Korean}}}}}}
